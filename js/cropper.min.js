/*
	Combined JavaScripts

	@codekit-append "../src/useful.cropper.js"
	@codekit-append "../../instances/src/useful.instances.js"
	@codekit-append "../../interactions/src/useful.interactions.js"
	@codekit-append "../../polyfills/src/useful.polyfills.js"
	@codekit-append "../../urls/src/useful.urls.js"
*//* **********************************************
     Begin useful.cropper.js
********************************************** *//*
	Source:
	van Creij, Maurice (2012). "useful.cropper.js: A simple image cropper", version 20130510, http://www.woollymittens.nl/.

	License:
	This work is licensed under a Creative Commons Attribution 3.0 Unported License.
*/(function(e){"use strict";e.Cropper=function(t,n){this.obj=t;this.cfg=n;this.names=["tl","tc","tr","ml","mr","bl","bc","br"];this.start=function(){var e=this;e.cfg.image=e.obj.getElementsByTagName("img")[0];e.cfg.output=e.obj.getElementsByTagName("input");e.cfg.onchange=e.cfg.onchange||function(){};e.cfg.delay=e.cfg.delay||1e3;e.cfg.minimum=e.cfg.minimum||.2;e.cfg.crop=e.cfg.crop||[.1,.1,.9,.9];e.cfg.url=e.cfg.image.src;e.cfg.offset=e.cfg.offset||4;e.busy.build(e);e.indicator.build(e);e.toolbar.build(e);e.loaded(e)};this.loaded=function(e){if(e.cfg.image.offsetWidth>0&&e.cfg.image.offsetHeight>0){e.update(e);e.preset(e)}else e.cfg.image.onload=function(){e.update(e);e.preset(e)}};this.preset=function(t){var n,r,i,s;if(t.cfg.image.offsetWidth){n=e.urls.load(t.cfg.url);if(n.left>0||n.top>0||n.right<1||n.bottom<1){n.left=n.left||0;n.top=n.top||0;n.right=n.right||1;n.bottom=n.bottom||1;t.cfg.left=n.left;t.cfg.top=n.top;t.cfg.right=n.right;t.cfg.bottom=n.bottom;r=t.cfg.image.offsetWidth;i=t.cfg.image.offsetHeight;s=i/(t.cfg.bottom-t.cfg.top)/(r/(t.cfg.right-t.cfg.left));r>i?i=r*s:r=i/s;r=Math.round(r);i=Math.round(i);t.cfg.image.style.maxWidth=r+"px";t.cfg.image.style.maxHeight=i+"px";t.cfg.url=e.urls.replace(t.cfg.url,"width",r);t.cfg.url=e.urls.replace(t.cfg.url,"height",i);t.cfg.url=e.urls.replace(t.cfg.url,"left",0);t.cfg.url=e.urls.replace(t.cfg.url,"top",0);t.cfg.url=e.urls.replace(t.cfg.url,"right",1);t.cfg.url=e.urls.replace(t.cfg.url,"bottom",1);t.obj.style.width=r+"px";t.obj.style.height=i+"px";t.cfg.image.style.marginTop=Math.round((t.obj.offsetHeight-t.cfg.image.offsetHeight-t.cfg.offset)/2)+"px";t.cfg.applyButton.disabled=!0;t.obj.className=t.obj.className.replace(" cr-disabled","")+" cr-disabled"}}};this.update=function(e){e.cfg.output[0].value=e.cfg.left;e.cfg.output[1].value=e.cfg.top;e.cfg.output[2].value=e.cfg.right;e.cfg.output[3].value=e.cfg.bottom;e.indicator.update(e)};this.busy={};this.busy.build=function(e){e.cfg.busy=document.createElement("span");e.cfg.busy.className="cr-busy";e.cfg.busy.innerHTML="Please wait...";e.cfg.busy.style.visibility="hidden";e.obj.appendChild(e.cfg.busy)};this.busy.show=function(e){e.cfg.busy.style.visibility="visible"};this.busy.hide=function(e){e.cfg.busy.style.visibility="hidden"};this.indicator={};this.indicator.build=function(t){t.cfg.overlay=document.createElement("span");t.cfg.overlay.className="cr-overlay";t.cfg.overlay.style.background="url("+t.cfg.image.src+")";t.indicator.handles.build(t);t.obj.appendChild(t.cfg.overlay);t.cfg.moving=!1;e.interactions.watch(t.cfg.overlay,{start:function(){t.cfg.moving=!0},end:function(){t.cfg.moving=!1},move:function(e){t.cfg.sizing||t.indicator.move(t,e)}})};this.indicator.update=function(e){var t,n,r,i;e.cfg.width=e.cfg.image.offsetWidth;e.cfg.height=e.cfg.image.offsetHeight;t=e.cfg.left*e.cfg.width;n=e.cfg.top*e.cfg.height;r=e.cfg.width-e.cfg.right*e.cfg.width;i=e.cfg.height-e.cfg.bottom*e.cfg.height;e.cfg.overlay.style.left=t+"px";e.cfg.overlay.style.top=n+"px";e.cfg.overlay.style.right=r+"px";e.cfg.overlay.style.bottom=i+"px";e.cfg.overlay.style.backgroundPosition="-"+t+"px -"+n+"px"};this.indicator.move=function(e,t){var n,r,i,s,o,u;n=(t[0].move.x-t[0].start.x)/e.cfg.width;r=(t[0].move.y-t[0].start.y)/e.cfg.height;i=e.cfg.left+n;s=e.cfg.top+r;o=e.cfg.right+n;u=e.cfg.bottom+r;if(i>=0&&s>=0&&o<=1&&u<=1&&i<o&&s<u){e.cfg.left=i;e.cfg.top=s;e.cfg.right=o;e.cfg.bottom=u}t[0].start.x=t[0].move.x;t[0].start.y=t[0].move.y;e.update(e)};this.indicator.handles={};this.indicator.handles.build=function(e){var t,n,r;e.cfg.handles={};for(t=0,n=e.names.length;t<n;t+=1){r=e.names[t];e.cfg.handles[r]=document.createElement("span");e.cfg.handles[r].className="cr-"+r;e.cfg.overlay.appendChild(e.cfg.handles[r]);e.cfg.sizing=!1;e.indicator.handles.move(e,r)}};this.indicator.handles.move=function(t,n){e.interactions.watch(t.cfg.handles[n],{start:function(){t.cfg.sizing=!0},end:function(){t.cfg.sizing=!1},move:function(e){switch(n){case"tl":t.indicator.handles.left(t,e);t.indicator.handles.top(t,e);break;case"tc":t.indicator.handles.top(t,e);break;case"tr":t.indicator.handles.right(t,e);t.indicator.handles.top(t,e);break;case"ml":t.indicator.handles.left(t,e);break;case"mr":t.indicator.handles.right(t,e);break;case"bl":t.indicator.handles.left(t,e);t.indicator.handles.bottom(t,e);break;case"bc":t.indicator.handles.bottom(t,e);break;case"br":t.indicator.handles.right(t,e);t.indicator.handles.bottom(t,e)}return!1}})};this.indicator.handles.left=function(e,t){var n,r,i,s;n=(t[0].move.x-t[0].start.x)/e.cfg.width;r=e.cfg.left+n;i=e.cfg.right+n;s=e.cfg.right-e.cfg.minimum;r>=0&&r<s&&(e.cfg.left=r);t[0].start.x=t[0].move.x;e.update(e)};this.indicator.handles.top=function(e,t){var n,r,i,s;n=(t[0].move.y-t[0].start.y)/e.cfg.height;r=e.cfg.top+n;i=e.cfg.bottom+n;s=e.cfg.bottom-e.cfg.minimum;r>=0&&r<s&&(e.cfg.top=r);t[0].start.y=t[0].move.y;e.update(e)};this.indicator.handles.right=function(e,t){var n,r,i,s;n=(t[0].move.x-t[0].start.x)/e.cfg.width;r=e.cfg.left+n;i=e.cfg.right+n;s=e.cfg.left+e.cfg.minimum;i<=1&&i>s&&(e.cfg.right=i);t[0].start.x=t[0].move.x;e.update(e)};this.indicator.handles.bottom=function(e,t){var n,r,i,s;n=(t[0].move.y-t[0].start.y)/e.cfg.height;r=e.cfg.top+n;i=e.cfg.bottom+n;s=e.cfg.top+e.cfg.minimum;i<=1&&i>s&&(e.cfg.bottom=i);t[0].start.y=t[0].move.y;e.update(e)};this.toolbar={};this.toolbar.build=function(e){e.cfg.toolbar=document.createElement("figcaption");e.cfg.applyButton=document.createElement("button");e.cfg.applyButton.setAttribute("type","button");e.cfg.applyButton.className="cr-apply button";e.cfg.applyButton.innerHTML="Apply";e.cfg.toolbar.appendChild(e.cfg.applyButton);e.cfg.applyButton.onclick=function(){e.toolbar.apply(e)};e.cfg.resetButton=document.createElement("button");e.cfg.resetButton.setAttribute("type","button");e.cfg.resetButton.className="cr-reset button";e.cfg.resetButton.innerHTML="Reset";e.cfg.toolbar.appendChild(e.cfg.resetButton);e.cfg.resetButton.onclick=function(){e.toolbar.reset(e)};e.obj.appendChild(e.cfg.toolbar)};this.toolbar.apply=function(t){var n,r,i;r=t.cfg.overlay.offsetWidth;i=t.cfg.overlay.offsetHeight;if(r>i){i=t.cfg.image.offsetWidth/r*t.cfg.overlay.offsetHeight;r=t.cfg.image.offsetWidth}else{r=t.cfg.image.offsetHeight/i*t.cfg.overlay.offsetWidth;i=t.cfg.image.offsetHeight}t.obj.style.width=t.cfg.image.offsetWidth+"px";t.obj.style.height=t.cfg.image.offsetHeight+"px";t.busy.show(t);t.cfg.image.onload=function(){t.cfg.image.style.marginTop=Math.round((t.obj.offsetHeight-t.cfg.image.offsetHeight-t.cfg.offset)/2)+"px";t.busy.hide(t)};r=Math.round(r);i=Math.round(i);n=t.cfg.image.src;n=e.urls.replace(n,"width",r);n=e.urls.replace(n,"height",i);n=e.urls.replace(n,"left",t.cfg.left);n=e.urls.replace(n,"top",t.cfg.top);n=e.urls.replace(n,"right",t.cfg.right);n=e.urls.replace(n,"bottom",t.cfg.bottom);t.cfg.image.src=n;t.cfg.applyButton.disabled=!0;t.obj.className=t.obj.className.replace(" cr-disabled","")+" cr-disabled";t.cfg.onchange(t.cfg.output[0]);return!1};this.toolbar.reset=function(e){e.busy.show(e);e.cfg.image.onload=function(){e.cfg.image.style.marginTop=0;e.cfg.left=0;e.cfg.top=0;e.cfg.right=1;e.cfg.bottom=1;e.update(e);e.cfg.applyButton.disabled=!1;e.obj.className=e.obj.className.replace(" cr-disabled","");e.busy.hide(e)};e.cfg.image.src=e.cfg.url;e.cfg.overlay.style.backgroundImage="url("+e.cfg.url+")";e.cfg.onchange(e.cfg.output[0]);return!1}}})(window.useful=window.useful||{});(function(e){"use strict";e.Instances=function(e,t,n){this.objs=e;this.constructor=t;this.cfgs=n;this.constructs=[];this.delay=200;this.wait=function(){var e=this;e.timeout=document.readyState.match(/interactive|loaded|complete/i)?e.start():setTimeout(function(){e.wait()},e.delay)};this.start=function(){for(var e=0,t=this.objs.length;e<t;e+=1){this.constructs[e]=new this.constructor(this.objs[e],Object.create(this.cfgs));this.constructs[e].start()}return null};this.getAll=function(){return this.constructs};this.getByObject=function(e){return this.constructs[this.constructs.indexOf(e)]};this.getByIndex=function(e){return this.constructs[e]}}})(window.useful=window.useful||{});(function(e){"use strict";var t=t||{};t.watch=function(e,n,r){"ontouchstart"in window||"onmsgesturechange"in window?t.touch(e,n,r):t.mouse(e,n,r);("ongesturestart"in window||"onmsgesturestart"in window)&&t.gestures(e,n,r)};t.mouse=function(e,t,n){var r,i,s,o;t=t||{};t.wheel=t.wheel||function(){};t.start=t.start||function(){};t.move=t.move||function(){};t.end=t.end||function(){};n=n||{};r=function(e){n.wheel={y:window.event?window.event.wheelDelta/120:-e.detail/3};t.wheel(n);return!1};e.onmousewheel=r;navigator.userAgent.match(/firefox/gi)&&e.addEventListener("DOMMouseScroll",r,!1);i=function(e){e=e||window.event;n[0]={};n[0].start={x:e.pageX||e.x,y:e.pageY||e.y};t.start(n);return!1};e.addEventListener("mousedown",i);s=function(e){e=e||window.event;if(n[0]&&n[0].start){n[0].move={x:e.pageX||e.x,y:e.pageY||e.y};t.move(n)}return!1};document.addEventListener("mousemove",s);o=function(e){e=e||window.event;n[0]&&(n[0].end={x:e.pageX||e.x,y:e.pageY||e.y});t.end(n);n[0]={};return!1};document.addEventListener("mouseup",o)};t.touch=function(e,t,n){var r,i,s;t=t||{};t.start=t.start||function(){};t.move=t.move||function(){};t.end=t.end||function(){};n=n||{};r=function(e){var r,i,s,o;s=e.touches||[e];for(r=0,i=s.length;r<i;r+=1){o=e.pointerId||r;n[o]={};n[o].start={x:s[r].pageX,y:s[r].pageY};t.start(n)}};e.ontouchstart=r;e.onmspointerdown=r;i=function(e){var r,i,s,o;s=e.touches||[e];for(r=0,i=s.length;r<i;r+=1){o=e.pointerId||r;if(n[o]&&n[o].start){n[o].move={x:s[r].pageX,y:s[r].pageY};t.move(n)}}return!1};e.ontouchmove=i;e.onmspointermove=i;s=function(e){var r,i,s,o;r=e.touches||[e];for(i=0,s=r.length;i<s;i+=1){if(n[o]&&n[o].start){n[o].end={x:r[i].pageX,y:r[i].pageY};t.end(n)}n[o]={}}};e.ontouchend=s;e.onmspointerup=s};t.gestures=function(e,t,n){var r,i,s;t=t||{};t.start=t.start||function(){};t.move=t.move||function(){};t.end=t.end||function(){};n=n||{};r=function(e){n[0]={};n[0].start={rotation:e.rotation,scale:e.scale};t.start(n)};e.ongesturestart=r;e.onmsgesturestart=r;i=function(e){if(n[0]&&n[0].start){n[0].move={rotation:e.rotation,scale:e.scale};t.move(n)}};e.ongesturechange=i;e.onmsgesturechange=i;s=function(e){n[0].end={rotation:e.rotation,scale:e.scale};t.end(n);n[0]={}};e.ongestureend=s;e.onmsmsgestureend=s};e.interactions=e.interactions||{};e.interactions.watch=t.watch})(window.useful=window.useful||{});(function(e){"use strict";var t=t||{};t.html5=function(){var e,t,n;n=["section","nav","article","aside","hgroup","header","footer","dialog","mark","dfn","time","progress","meter","ruby","rt","rp","ins","del","figure","figcaption","video","audio","source","canvas","datalist","keygen","output","details","datagrid","command","bb","menu","legend"];if(navigator.userAgent.match(/msie/gi))for(e=0,t=n.length;e<t;e+=1)document.createElement(n[e])};t.arrayIndexOf=function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var n=t||0,r=this.length;n<r;n+=1)if(this[n]===e)return n;return-1})};t.querySelectorAll=function(){document.querySelectorAll||(document.querySelectorAll=function(e){var t=document,n=t.documentElement.firstChild,r=t.createElement("STYLE");return n.appendChild(r),t.__qsaels=[],r.styleSheet.cssText=e+"{x:expression(document.__qsaels.push(this))}",window.scrollBy(0,0),t.__qsaels})};t.addEventListener=function(){!window.addEventListener&&function(e,t,n,r,i,s,o){e[r]=t[r]=n[r]=function(e,t){var n=this;o.unshift([n,e,t,function(e){e.currentTarget=n;e.preventDefault=function(){e.returnValue=!1};e.stopPropagation=function(){e.cancelBubble=!0};e.target=e.srcElement||n;t.call(n,e)}]);this.attachEvent("on"+e,o[0][3])};e[i]=t[i]=n[i]=function(e,t){for(var n=0,r;r=o[n];++n)if(r[0]==this&&r[1]==e&&r[2]==t)return this.detachEvent("on"+e,o.splice(n,1)[0][3])};e[s]=t[s]=n[s]=function(e){return this.fireEvent("on"+e.type,e)}}(Window.prototype,HTMLDocument.prototype,Element.prototype,"addEventListener","removeEventListener","dispatchEvent",[])};t.consoleLog=function(){if(!window.console){window.console={};window.console.log=function(){var e,t,n="",r=document.getElementById("reportPanel");if(!r){r=document.createElement("DIV");r.id="reportPanel";r.style.background="#fff none";r.style.border="solid 1px #000";r.style.color="#000";r.style.fontSize="12px";r.style.padding="10px";r.style.position=navigator.userAgent.indexOf("MSIE 6")>-1?"absolute":"fixed";r.style.right="10px";r.style.bottom="10px";r.style.width="180px";r.style.height="320px";r.style.overflow="auto";r.style.zIndex="100000";r.innerHTML="&nbsp;";document.body.appendChild(r)}var i=r.innerHTML.length<1e3?r.innerHTML:r.innerHTML.substring(0,800);for(e=0,t=arguments.length;e<t;e+=1)n+=arguments[e]+"<br/>";r.innerHTML=n+i}}};t.objectCreate=function(){typeof Object.create!="function"&&(Object.create=function(e){function t(){}t.prototype=e;return new t})};t.stringTrim=function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")});String.prototype.ltrim||(String.prototype.ltrim=function(){return this.replace(/^\s+/,"")});String.prototype.rtrim||(String.prototype.rtrim=function(){return this.replace(/\s+$/,"")});String.prototype.fulltrim||(String.prototype.fulltrim=function(){return this.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")})};t.html5();t.arrayIndexOf();t.querySelectorAll();t.addEventListener();t.consoleLog();t.objectCreate();t.stringTrim()})(window.useful=window.useful||{});(function(e){"use strict";var t=t||{};t.load=function(e){var t,n,r=[],i={},s,o;r=e.split("#")[0].replace("?","&").split("&");for(t=1,n=r.length;t<n;t+=1){s=r[t].split("=");o=parseFloat(s[1]);i[s[0]]=isNaN(o)?s[1]:o}return i};t.save=function(e,t){var n;e=e.split("?")[0].split("#")[0];for(n in t)t.hasOwnProperty(n)&&(e+="&"+n+"="+t[n]);return e.replace("&","?")};t.replace=function(e,n,r){var i,s,o;s=new RegExp(n+"=","gi");if(s.test(e)){i=e.split("#")[0].split(n+"=")[1].split("&")[0];return e.replace(n+"="+i,n+"="+r)}o=t.load(e);o[n]=r;return t.save(e,o)};e.urls=e.urls||{};e.urls.load=t.load;e.urls.save=t.save;e.urls.replace=t.replace})(window.useful=window.useful||{});